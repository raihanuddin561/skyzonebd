// B2B Ecommerce Database Schema
// Database: sagor_db (PostgreSQL)

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User Management - Simple Registration
model User {
  id           String   @id @default(cuid())
  email        String   @unique
  name         String   // Required
  phone        String   // Required (mobile)
  companyName  String?  // Optional - can add later
  password     String
  role         UserRole @default(BUYER)
  userType     UserType @default(WHOLESALE)
  isActive     Boolean  @default(true)
  isVerified   Boolean  @default(false)   // Optional business verification
  
  // Profit Sharing Configuration (for sellers/partners)
  profitSharePercentage Float?  // Percentage of profit this seller/partner receives
  isProfitPartner       Boolean @default(false)  // Is this user a profit-sharing partner?
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  // Business Information (Optional - can complete from profile later)
  businessInfo BusinessInfo?
  
  // Relations
  orders       Order[]
  addresses    Address[]
  rfqs         RFQ[]
  products     Product[]  // Products created/managed by this user (seller)
  activityLogs ActivityLog[]  // Admin activity logs
  dataDeletionRequests DataDeletionRequest[]  // GDPR data deletion requests
  permissions  UserPermission[]  // Granular permissions for this user
  
  @@map("users")
}

// User Permissions - Granular Access Control
model UserPermission {
  id          String   @id @default(cuid())
  userId      String
  module      PermissionModule  // Which module/feature
  canView     Boolean  @default(false)
  canCreate   Boolean  @default(false)
  canEdit     Boolean  @default(false)
  canDelete   Boolean  @default(false)
  canApprove  Boolean  @default(false)  // For approval workflows
  canExport   Boolean  @default(false)  // Export data
  
  grantedBy   String?  // Admin who granted this permission
  grantedAt   DateTime @default(now())
  expiresAt   DateTime?  // Optional expiration
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([userId, module])
  @@map("user_permissions")
  @@index([userId])
  @@index([module])
}

enum PermissionModule {
  // Inventory Management
  INVENTORY_VIEW
  INVENTORY_MANAGE
  INVENTORY_REPORTS
  
  // Employee Management
  EMPLOYEES_VIEW
  EMPLOYEES_MANAGE
  EMPLOYEES_REPORTS
  
  // Salary Management
  SALARIES_VIEW
  SALARIES_MANAGE
  SALARIES_PROCESS
  SALARIES_APPROVE
  
  // Operational Costs
  COSTS_VIEW
  COSTS_MANAGE
  COSTS_APPROVE
  
  // Profit & Loss
  PROFIT_LOSS_VIEW
  PROFIT_LOSS_REPORTS
  
  // Products
  PRODUCTS_VIEW
  PRODUCTS_MANAGE
  
  // Orders
  ORDERS_VIEW
  ORDERS_MANAGE
  ORDERS_PROCESS
  
  // Customers
  CUSTOMERS_VIEW
  CUSTOMERS_MANAGE
  
  // Categories
  CATEGORIES_VIEW
  CATEGORIES_MANAGE
  
  // Users & Permissions
  USERS_VIEW
  USERS_MANAGE
  PERMISSIONS_MANAGE
  
  // System Settings
  SETTINGS_VIEW
  SETTINGS_MANAGE
  
  // Reports & Analytics
  REPORTS_VIEW
  REPORTS_EXPORT
  ANALYTICS_VIEW
}

// Business Information (Optional - can complete from profile)
model BusinessInfo {
  id                    String   @id @default(cuid())
  userId                String   @unique
  companyType           String?  // Optional: Retailer, Distributor, Manufacturer, Reseller
  registrationNumber    String?  // Optional
  taxId                 String?  // Optional
  website               String?
  employeeCount         String?
  annualPurchaseVolume  String?
  tradeLicenseUrl       String?  // Optional: Trade license document
  taxCertificateUrl     String?  // Optional: Tax certificate/TIN certificate
  verificationStatus    VerificationStatus @default(PENDING)
  verifiedAt            DateTime?
  
  // Additional Business Information (Optional)
  businessAddress       String?
  businessCity          String?
  businessCountry       String   @default("Bangladesh")
  shippingPreferences   String?  // Bulk/Pallet/Container shipping
  paymentTerms          String?  // Payment terms preference
  creditLimit           Float?   // Maximum credit allowed
  
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  
  // Relations
  user                  User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("business_info")
}

model Address {
  id           String      @id @default(cuid())
  userId       String
  type         AddressType @default(SHIPPING)
  street       String
  city         String
  state        String?
  postalCode   String?
  country      String      @default("Bangladesh")
  isDefault    Boolean     @default(false)
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  
  // Relations
  user         User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("addresses")
}

// Unit Management
// Stores measurement units for products (kg, liter, piece, etc.)
model Unit {
  id          String    @id @default(cuid())
  name        String    @unique // e.g., "Piece", "Kilogram", "Liter"
  symbol      String    @unique // e.g., "pcs", "kg", "L"
  description String?
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  @@map("units")
}

// Product Management
model Category {
  id          String    @id @default(cuid())
  name        String    @unique
  slug        String    @unique
  description String?
  imageUrl    String?
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  // Relations
  products    Product[]
  
  @@map("categories")
}

model Product {
  id               String        @id @default(cuid())
  name             String
  slug             String        @unique
  description      String?
  
  // Images (Vercel Blob URLs)
  imageUrl         String        // Primary product image
  imageUrls        String[]      @default([]) // Additional images (gallery)
  thumbnailUrl     String?       // Optimized thumbnail
  
  // Product Details
  brand            String?
  tags             String[]      @default([])
  specifications   Json?         // Flexible specifications as JSON
  unit             String?       // Unit of measurement (stores unit symbol) - optional
  
  // WHOLESALE PRICING ONLY
  basePrice        Float         // Base cost price (what platform pays)
  wholesalePrice   Float         // Selling price to wholesale customers
  moq              Int?          // Minimum Order Quantity (optional)
  
  // Profit Calculation
  platformProfitPercentage Float @default(15) // Admin-controlled profit %
  calculatedProfit         Float?             // Auto-calculated: (wholesalePrice - basePrice) * platformProfitPercentage/100
  sellerProfit             Float?             // Profit allocated to seller/partner
  
  // Inventory Management
  stockQuantity    Int           @default(0)
  reorderLevel     Int           @default(20)      // Alert when stock reaches this level
  reorderQuantity  Int           @default(100)     // Suggested reorder quantity
  availability     String        @default("in_stock") // in_stock, limited, out_of_stock, pre_order
  sku              String?       @unique
  batchNumber      String?       // For batch tracking
  expiryDate       DateTime?     // For perishable goods
  
  // Cost Tracking
  costPerUnit      Float?        // Actual cost per unit (for profit calculation)
  shippingCost     Float?        // Shipping cost per unit
  handlingCost     Float?        // Handling/storage cost per unit
  
  // Seller Information (For multi-vendor/partner model)
  sellerId         String?       // Partner who supplies this product
  sellerCommissionPercentage Float? // Partner's commission percentage
  
  // Metadata
  categoryId       String
  isActive         Boolean       @default(true)
  isFeatured       Boolean       @default(false)
  rating           Float?
  reviewCount      Int           @default(0)
  
  // Wholesale Preferences
  allowSamples     Boolean       @default(false) // Allow sample orders
  sampleMOQ        Int           @default(1)     // MOQ for samples
  samplePrice      Float?        // Price per sample unit
  customizationAvailable Boolean  @default(false) // Can be customized
  
  // SEO
  metaTitle        String?
  metaDescription  String?
  
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  
  // Relations
  category         Category      @relation(fields: [categoryId], references: [id])
  seller           User?         @relation(fields: [sellerId], references: [id], onDelete: SetNull)
  orderItems       OrderItem[]
  wholesaleTiers   WholesaleTier[] // Volume-based pricing
  rfqItems         RFQItem[]
  heroSlides       HeroSlide[]
  inventoryLogs    InventoryLog[] // Track inventory changes
  profitReports    ProfitReport[] // Profit analysis per product
  
  @@map("products")
}

// Wholesale Pricing Tiers for Volume-based Discounts
model WholesaleTier {
  id          String   @id @default(cuid())
  productId   String
  minQuantity Int      // Minimum quantity for this tier
  maxQuantity Int?     // null means unlimited/highest tier
  price       Float    // Price per unit at this tier
  discount    Float    // Percentage discount from base wholesale price
  
  // Profit calculation for this tier
  profitMargin Float?  // Profit margin % at this tier
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  @@unique([productId, minQuantity])
  @@map("wholesale_tiers")
}

// Order Management
model Order {
  id              String        @id @default(cuid())
  orderNumber     String        @unique
  userId          String?       // Optional - nullable for guest orders
  
  // Guest Order Information
  guestName       String?
  guestPhone      String?       // Required for guest
  guestEmail      String?
  
  // Order Details
  subtotal        Float
  tax             Float         @default(0)
  shipping        Float         @default(0)
  total           Float
  
  // Profit Tracking
  totalCost       Float?        // Total cost of goods
  grossProfit     Float?        // Total revenue - total cost
  platformProfit  Float?        // Platform's share of profit
  sellerProfit    Float?        // Seller's/Partner's share
  profitMargin    Float?        // Profit margin percentage
  
  // Status
  status          OrderStatus   @default(PENDING)
  paymentStatus   PaymentStatus @default(PENDING)
  paymentMethod   String
  
  // Cancellation
  cancelledAt     DateTime?
  cancelledBy     String?       // userId of who cancelled (admin or customer)
  cancellationReason String?
  
  // Addresses
  shippingAddress String
  billingAddress  String
  
  // Wholesale Specific
  purchaseOrderNumber String?   // Customer's PO number
  deliveryDate        DateTime? // Requested delivery date
  paymentTerms        String?   // NET30, NET60, etc.
  invoiceUrl          String?   // Generated invoice PDF URL
  
  // Notes
  notes           String?
  internalNotes   String?       // Admin/seller notes (not visible to customer)
  
  // Timestamps
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  // Relations
  user            User?         @relation(fields: [userId], references: [id])
  orderItems      OrderItem[]
  payments        Payment[]
  profitReports   ProfitReport[]
  
  @@map("orders")
}

model OrderItem {
  id        String   @id @default(cuid())
  orderId   String
  productId String
  quantity  Int
  price     Float    // Price per unit at time of order
  total     Float    // quantity * price
  
  // Profit Tracking per Item
  costPerUnit     Float?   // Cost per unit at time of order
  profitPerUnit   Float?   // Profit per unit
  totalProfit     Float?   // Total profit for this line item
  profitMargin    Float?   // Profit margin % for this item
  
  createdAt DateTime @default(now())
  
  // Relations
  order     Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product   Product  @relation(fields: [productId], references: [id])
  
  @@map("order_items")
}

// Payment Management
model Payment {
  id            String        @id @default(cuid())
  orderId       String
  amount        Float
  method        PaymentMethod
  status        PaymentStatus @default(PENDING)
  transactionId String?
  gateway       String?       // bKash, Nagad, etc.
  gatewayRef    String?       // Gateway transaction reference
  notes         String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  
  // Relations
  order         Order         @relation(fields: [orderId], references: [id], onDelete: Cascade)
  
  @@map("payments")
}

// Request for Quote (B2B Feature)
model RFQ {
  id              String      @id @default(cuid())
  rfqNumber       String      @unique
  userId          String
  subject         String
  message         String?
  targetPrice     Float?
  status          RFQStatus   @default(PENDING)
  expiresAt       DateTime?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  // Relations
  user            User        @relation(fields: [userId], references: [id])
  items           RFQItem[]
  
  @@map("rfqs")
}

model RFQItem {
  id          String   @id @default(cuid())
  rfqId       String
  productId   String
  quantity    Int
  notes       String?
  createdAt   DateTime @default(now())
  
  // Relations
  rfq         RFQ      @relation(fields: [rfqId], references: [id], onDelete: Cascade)
  product     Product  @relation(fields: [productId], references: [id])
  
  @@map("rfq_items")
}

// Enums
enum UserRole {
  ADMIN
  SELLER
  BUYER
}

enum UserType {
  RETAIL      // Retail customers (individual buyers)
  WHOLESALE   // Wholesale/Business customers
  SELLER      // Sellers/Suppliers
  ADMIN       // Platform administrators
  GUEST       // Guest checkout with mobile + address only
}

enum VerificationStatus {
  PENDING
  APPROVED
  REJECTED
  RESUBMIT
}

enum RFQStatus {
  PENDING
  QUOTED
  ACCEPTED
  REJECTED
  EXPIRED
}

enum AddressType {
  SHIPPING
  BILLING
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  PACKED
  SHIPPED
  IN_TRANSIT
  DELIVERED
  CANCELLED
  RETURNED
  REFUNDED
}

enum PaymentStatus {
  PENDING
  PAID
  PARTIAL
  FAILED
  REFUNDED
}

enum PaymentMethod {
  BANK_TRANSFER
  BKASH
  NAGAD
  ROCKET
  CREDIT_CARD
  INVOICE_NET30  // Wholesale payment terms
  INVOICE_NET60
  INVOICE_NET90
  LC             // Letter of Credit for large orders
}

enum InventoryAction {
  PURCHASE       // Stock added from supplier
  SALE           // Stock reduced from order
  RETURN         // Stock returned from customer
  ADJUSTMENT     // Manual adjustment by admin
  DAMAGE         // Damaged stock write-off
  EXPIRED        // Expired stock write-off
  TRANSFER       // Stock transfer between warehouses
  RECOUNT        // Physical inventory recount
}

// Hero Slider for Homepage
model HeroSlide {
  id          String   @id @default(cuid())
  title       String
  subtitle    String?
  imageUrl    String   // Main banner image
  linkUrl     String?  // Link to product or category
  productId   String?  // Optional: Link to specific product
  buttonText  String   @default("Shop Now")
  position    Int      @default(0) // Order of slides
  isActive    Boolean  @default(true)
  bgColor     String   @default("#3B82F6") // Background color (hex)
  textColor   String   @default("#FFFFFF") // Text color (hex)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  product     Product? @relation(fields: [productId], references: [id], onDelete: SetNull)
  
  @@map("hero_slides")
  @@index([position])
  @@index([isActive])
}

// Admin Activity Tracking
model ActivityLog {
  id            String         @id @default(cuid())
  userId        String         // Admin who performed the action
  userName      String         // Store name for quick reference
  action        ActivityAction // Type of action performed
  entityType    String         // Product, Order, Category, User, etc.
  entityId      String?        // ID of the affected entity
  entityName    String?        // Name/title of the affected entity
  description   String         // Human-readable description
  metadata      Json?          // Additional data (old values, new values, etc.)
  ipAddress     String?        // IP address of the admin
  userAgent     String?        // Browser/device info
  createdAt     DateTime       @default(now())
  
  // Relations
  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("activity_logs")
  @@index([userId])
  @@index([action])
  @@index([entityType])
  @@index([createdAt])
}

enum ActivityAction {
  CREATE
  UPDATE
  DELETE
  STATUS_CHANGE
  CANCEL
  RESTORE
  EXPORT
  IMPORT
  LOGIN
  LOGOUT
}

enum DeletionRequestStatus {
  PENDING
  PROCESSING
  COMPLETED
  REJECTED
  CANCELLED
}

// Inventory Management System
model InventoryLog {
  id              String          @id @default(cuid())
  productId       String
  action          InventoryAction
  quantity        Int             // Positive for additions, negative for reductions
  previousStock   Int             // Stock before action
  newStock        Int             // Stock after action
  reference       String?         // Order ID, PO number, etc.
  notes           String?
  performedBy     String?         // User ID who performed the action
  createdAt       DateTime        @default(now())
  
  // Relations
  product         Product         @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  @@map("inventory_logs")
  @@index([productId])
  @@index([action])
  @@index([createdAt])
}

// Profit Sharing & Reporting
model ProfitReport {
  id                    String   @id @default(cuid())
  orderId               String
  productId             String?  // Null for order-level report
  
  // Revenue & Cost
  revenue               Float    // Total sales revenue
  costOfGoods           Float    // Total cost of goods sold
  grossProfit           Float    // Revenue - Cost
  
  // Expenses
  shippingExpense       Float    @default(0)
  handlingExpense       Float    @default(0)
  platformExpense       Float    @default(0) // Platform operational costs
  marketingExpense      Float    @default(0)
  otherExpenses         Float    @default(0)
  totalExpenses         Float    // Sum of all expenses
  
  // Net Profit
  netProfit             Float    // Gross profit - Total expenses
  profitMargin          Float    // (Net profit / Revenue) * 100
  
  // Profit Distribution
  platformProfit        Float    // Platform's share
  platformProfitPercent Float    // Platform profit percentage (set by admin)
  sellerProfit          Float    // Seller/Partner's share
  sellerProfitPercent   Float    // Seller profit percentage
  sellerId              String?  // Partner/Seller who gets the share
  
  // Period
  reportPeriod          String?  // Daily, Weekly, Monthly, etc.
  reportDate            DateTime @default(now())
  
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  
  // Relations
  order                 Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product               Product? @relation(fields: [productId], references: [id], onDelete: SetNull)
  
  @@map("profit_reports")
  @@index([orderId])
  @@index([productId])
  @@index([reportDate])
}

// Platform Configuration for Profit Sharing
model PlatformConfig {
  id                        String   @id @default(cuid())
  key                       String   @unique  // Configuration key
  value                     String   // Configuration value (JSON string for complex values)
  description               String?
  category                  String   @default("general") // general, profit, inventory, etc.
  
  // Common profit sharing configs:
  // - default_platform_profit_percentage
  // - default_seller_profit_percentage
  // - minimum_order_value
  // - maximum_credit_limit
  // - reorder_notification_enabled
  
  createdAt                 DateTime @default(now())
  updatedAt                 DateTime @updatedAt
  
  @@map("platform_config")
}

// Warehouse/Location Management (for multi-location inventory)
model Warehouse {
  id              String   @id @default(cuid())
  name            String
  code            String   @unique  // Warehouse code (e.g., WH-DHK-01)
  address         String
  city            String
  country         String   @default("Bangladesh")
  contactPerson   String?
  contactPhone    String?
  isActive        Boolean  @default(true)
  isPrimary       Boolean  @default(false)  // Primary warehouse
  capacity        Int?     // Storage capacity
  currentLoad     Int?     // Current storage utilization
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@map("warehouses")
}

// Employee Management
model Employee {
  id              String           @id @default(cuid())
  employeeId      String           @unique // Custom employee ID (e.g., EMP-001)
  firstName       String
  lastName        String
  email           String           @unique
  phone           String
  dateOfBirth     DateTime?
  gender          String?
  address         String?
  city            String?
  country         String           @default("Bangladesh")
  
  // Employment Details
  department      String           // Sales, Operations, IT, HR, Finance, etc.
  designation     String           // Manager, Associate, Executive, etc.
  employmentType  EmploymentType   @default(FULL_TIME)
  joiningDate     DateTime
  resignationDate DateTime?
  isActive        Boolean          @default(true)
  
  // Salary Information
  baseSalary      Float            // Monthly base salary
  allowances      Float            @default(0) // Housing, transport, etc.
  bonuses         Float            @default(0) // Performance bonuses
  
  // Emergency Contact
  emergencyContact String?
  emergencyPhone   String?
  
  // Documents
  nidNumber       String?          // National ID
  tinNumber       String?          // Tax Identification Number
  bankAccount     String?
  bankName        String?
  
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  
  // Relations
  salaries        Salary[]
  attendances     Attendance[]
  
  @@map("employees")
  @@index([employeeId])
  @@index([department])
  @@index([isActive])
}

enum EmploymentType {
  FULL_TIME
  PART_TIME
  CONTRACT
  INTERN
  FREELANCE
}

// Salary Records
model Salary {
  id              String        @id @default(cuid())
  employeeId      String
  employee        Employee      @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  
  // Salary Period
  month           Int           // 1-12
  year            Int
  
  // Salary Components
  baseSalary      Float
  allowances      Float         @default(0)
  bonuses         Float         @default(0)
  overtime        Float         @default(0)
  grossSalary     Float         // baseSalary + allowances + bonuses + overtime
  
  // Deductions
  tax             Float         @default(0)
  providentFund   Float         @default(0)
  insurance       Float         @default(0)
  loan            Float         @default(0)
  otherDeductions Float         @default(0)
  totalDeductions Float         // Sum of all deductions
  
  // Net Salary
  netSalary       Float         // grossSalary - totalDeductions
  
  // Payment Details
  paymentStatus   PaymentStatus @default(PENDING)
  paymentDate     DateTime?
  paymentMethod   String?       // Bank Transfer, Cash, Cheque
  paymentReference String?      // Transaction ID or Cheque number
  
  // Attendance
  workingDays     Int           @default(0)
  presentDays     Int           @default(0)
  absentDays      Int           @default(0)
  leaveDays       Int           @default(0)
  
  notes           String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  @@unique([employeeId, month, year])
  @@map("salaries")
  @@index([employeeId])
  @@index([month, year])
  @@index([paymentStatus])
}

// Attendance Tracking
model Attendance {
  id          String   @id @default(cuid())
  employeeId  String
  employee    Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  
  date        DateTime
  checkIn     DateTime?
  checkOut    DateTime?
  status      AttendanceStatus @default(PRESENT)
  workHours   Float?   // Calculated work hours
  overtime    Float?   // Overtime hours
  
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@unique([employeeId, date])
  @@map("attendances")
  @@index([employeeId])
  @@index([date])
  @@index([status])
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  HALF_DAY
  LEAVE
  HOLIDAY
  SICK_LEAVE
  CASUAL_LEAVE
  WORK_FROM_HOME
}

// Operational Costs/Expenses
model OperationalCost {
  id              String        @id @default(cuid())
  category        CostCategory
  subCategory     String?       // More specific categorization
  description     String
  amount          Float
  
  // Period
  date            DateTime      @default(now())
  month           Int           // 1-12
  year            Int
  
  // Payment Details
  paymentStatus   PaymentStatus @default(PENDING)
  paymentDate     DateTime?
  paymentMethod   String?
  paymentReference String?      // Invoice number, receipt number
  
  // Vendor/Supplier
  vendor          String?
  vendorContact   String?
  
  // Approval
  isApproved      Boolean       @default(false)
  approvedBy      String?       // Admin user ID
  approvedAt      DateTime?
  
  // Recurring
  isRecurring     Boolean       @default(false)
  recurringPeriod String?       // Monthly, Quarterly, Yearly
  
  notes           String?
  attachmentUrl   String?       // Receipt/invoice attachment
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  @@map("operational_costs")
  @@index([category])
  @@index([month, year])
  @@index([paymentStatus])
  @@index([date])
}

enum CostCategory {
  RENT              // Office/warehouse rent
  UTILITIES         // Electricity, water, internet
  SALARIES          // Employee salaries
  MARKETING         // Advertising, promotions
  SHIPPING          // Delivery and logistics
  PACKAGING         // Packaging materials
  OFFICE_SUPPLIES   // Stationery, equipment
  MAINTENANCE       // Repairs, servicing
  INSURANCE         // Business insurance
  TAXES             // Business taxes
  LEGAL             // Legal fees
  SOFTWARE          // Software subscriptions
  INVENTORY         // Inventory purchase costs
  TRANSPORTATION    // Vehicle fuel, maintenance
  COMMUNICATION     // Phone, internet bills
  TRAINING          // Employee training
  ENTERTAINMENT     // Client entertainment
  BANK_CHARGES      // Banking fees
  DEPRECIATION      // Asset depreciation
  MISCELLANEOUS     // Other expenses
}

// Comprehensive Profit & Loss Report
model ProfitLossReport {
  id              String   @id @default(cuid())
  
  // Period
  month           Int      // 1-12
  year            Int
  startDate       DateTime
  endDate         DateTime
  
  // Revenue
  totalRevenue    Float    // Total sales revenue
  returnRevenue   Float    @default(0) // Revenue from returns
  netRevenue      Float    // Total - Returns
  
  // Cost of Goods Sold (COGS)
  openingStock    Float    @default(0)
  purchases       Float    @default(0) // Inventory purchases
  closingStock    Float    @default(0)
  cogs            Float    // Opening + Purchases - Closing
  
  // Gross Profit
  grossProfit     Float    // Net Revenue - COGS
  grossMargin     Float    // (Gross Profit / Net Revenue) * 100
  
  // Operating Expenses
  salaryExpense   Float    @default(0)
  rentExpense     Float    @default(0)
  utilitiesExpense Float   @default(0)
  marketingExpense Float   @default(0)
  shippingExpense Float    @default(0)
  otherExpenses   Float    @default(0)
  totalOperatingExpenses Float
  
  // Operating Profit
  operatingProfit Float    // Gross Profit - Operating Expenses
  operatingMargin Float    // (Operating Profit / Net Revenue) * 100
  
  // Net Profit
  netProfit       Float    // Operating Profit - Other Expenses
  netMargin       Float    // (Net Profit / Net Revenue) * 100
  
  // Additional Metrics
  orderCount      Int      @default(0)
  customerCount   Int      @default(0)
  averageOrderValue Float  @default(0)
  
  generatedAt     DateTime @default(now())
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@unique([month, year])
  @@map("profit_loss_reports")
  @@index([month, year])
}

// Data Deletion Request Model (for GDPR/Google Play compliance)
model DataDeletionRequest {
  id              String                 @id @default(cuid())
  userId          String
  user            User                   @relation(fields: [userId], references: [id], onDelete: Cascade)
  email           String
  phone           String
  reason          String?
  status          DeletionRequestStatus  @default(PENDING)
  requestedAt     DateTime               @default(now())
  processedAt     DateTime?
  processedBy     String?                // Admin user ID who processed the request
  completedAt     DateTime?
  rejectedAt      DateTime?
  rejectionReason String?
  ipAddress       String?
  userAgent       String?
  notes           String?                // Admin notes
  createdAt       DateTime               @default(now())
  updatedAt       DateTime               @updatedAt

  @@index([userId])
  @@index([status])
  @@index([email])
  @@map("data_deletion_requests")
}
